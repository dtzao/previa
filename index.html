<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consulta de Escala â€“ PMESP</title>

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  background: linear-gradient(180deg, #0a0f1a, #000);
  font-family: "Segoe UI", Arial, sans-serif;
  color: #e0e0e0;
}

.container {
  max-width: 600px;
  margin: auto;
  padding: 30px 16px;
  text-align: center;
}

h1 {
  color: #1e88ff;
  font-size: 26px;
  margin-bottom: 8px;
}

.sub {
  font-size: 14px;
  color: #aaa;
  margin-bottom: 25px;
}

input {
  width: 100%;
  padding: 16px;
  font-size: 18px;
  border-radius: 12px;
  border: none;
  background: #121826;
  color: #fff;
  text-align: center;
}

button {
  width: 100%;
  margin-top: 15px;
  padding: 16px;
  font-size: 18px;
  border-radius: 12px;
  border: none;
  background: #1e88ff;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
}

button:hover {
  background: #166fd1;
}

.resultado {
  margin-top: 25px;
  padding: 20px;
  border-radius: 14px;
  display: none;
}

.encontrado {
  background: rgba(30,136,255,0.15);
  border: 1px solid #1e88ff;
}

.nao-encontrado {
  background: rgba(255,70,70,0.15);
  border: 1px solid #ff4d4d;
}

.resultado p {
  margin: 6px 0;
  font-size: 16px;
}

footer {
  margin-top: 40px;
  font-size: 12px;
  color: #777;
}
</style>
</head>

<body>

<div class="container">
  <h1>PolÃ­cia Militar do Estado de SÃ£o Paulo</h1>
  <div class="sub">Consulta de Escala Operacional</div>

  <input
    id="reInput"
    placeholder="Digite o RE (ex: 154.466-7)"
    inputmode="numeric"
  >

  <button onclick="consultar()">Consultar Escala</button>

  <div id="resultado" class="resultado"></div>

  <footer>
    SD PM 154.466-7 ANDERSON SILVA
  </footer>
</div>

<script>
const CSV_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vStjOw-tr--fHNCQjTq7Ufx9uZx2IsOk19PwP7GmAY_botbjA9scRBDgFJHdzeTkbPLxFZxC-6Ddy3m/pub?gid=GID_DA_ABA_CONSULTA&single=true&output=csv";

const input = document.getElementById("reInput");
const resultado = document.getElementById("resultado");

/* ðŸ”’ Bloqueia letras */
input.addEventListener("input", () => {
  input.value = input.value.replace(/[^\d.-]/g, "");
});

/* ðŸ”„ Cache local */
let linhas = JSON.parse(localStorage.getItem("escala_cache") || "null");

if (!linhas) {
  fetch(CSV_URL)
    .then(r => r.text())
    .then(csv => {
      linhas = csv.split(/\r?\n/);
      localStorage.setItem("escala_cache", JSON.stringify(linhas));
    });
}

/* ðŸ”¹ Normaliza RE */
function normalizar(valor) {
  return valor.replace(/\D/g, "");
}

function consultar() {
  const reDigitado = normalizar(input.value);

  resultado.style.display = "none";

  if (reDigitado.length < 6) return;

  for (let i = 1; i < linhas.length; i++) {
    const col = linhas[i].split(";");

    const re = normalizar(col[1] || "");
    const nome = (col[2] || "").trim();
    const unidade = (col[3] || "").trim();
    const escala = (col[4] || "").trim();

    if (re === reDigitado) {
      resultado.className = "resultado encontrado";
      resultado.innerHTML = `
        <p><strong>${nome}</strong></p>
        <p>${unidade}</p>
        <p><strong>Escala:</strong> ${escala}</p>
      `;
      resultado.style.display = "block";
      return;
    }
  }

  resultado.className = "resultado nao-encontrado";
  resultado.innerHTML =
    "<p>RE nÃ£o localizado.</p><p>Procure um superior da escala.</p>";
  resultado.style.display = "block";
}
</script>

</body>
</html>
